import{j as e,u as s}from"./query-9fe77bbe.js";import{r as a}from"./vendor-5e66fe52.js";import{L as t}from"./router-d215a13b.js";import{B as l,w as r,C as i,a as d,b as n,h as c,c as o,I as x,F as m,v as h,x as j,y as u,z as p,L as N,A as f,u as v,o as g,D as b,t as y,E as k,p as w,G as C,H as S,f as A,J as L}from"./index-654029b0.js";import{o as z,s as E,e as P,u as q}from"./forms-1427850a.js";import{t as F}from"./zod-7016e973.js";import{C as D}from"./ConfirmDialog-287d4948.js";import{a as I,b as T,c as B,d as V}from"./useClients-84110019.js";import{u as $}from"./useRealtime-32953116.js";import"./supabase-e62705ad.js";import"./icons-9f4f2400.js";import"./BaseService-e2aecc13.js";const G=z({name:E().min(1,"Name is required"),email:E().email("Invalid email address"),phone:E().optional(),address:E().optional(),status:P(["lead","prospect","active","churned"]).default("lead"),notes:E().optional()});function K({client:s,onSave:t,onCancel:v,isLoading:g=!1}){const[b,y]=a.useState(!1),{register:k,handleSubmit:w,formState:{errors:C},reset:S,setValue:A}=q({resolver:F(G),defaultValues:{name:"",email:"",phone:"",address:"",status:"lead",notes:""}});a.useEffect(()=>{s?(A("name",s.name),A("email",s.email),A("phone",s.phone||""),A("address",s.address||""),A("status",s.status),A("notes",s.notes||"")):S()},[s,A,S]);return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:s?"Edit Client":"Add New Client"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:v,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:e.jsx(r,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:w(async e=>{y(!0);try{await t(e)}catch(s){}finally{y(!1)}}),className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(n,{className:"flex items-center text-lg",children:[e.jsx(c,{className:"w-5 h-5 mr-2 text-primary"}),"Basic Information"]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Full Name *"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(x,{...k("name"),placeholder:"Enter full name",className:"pl-10",disabled:b||g})]}),C.name&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:C.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Email Address *"}),e.jsxs("div",{className:"relative",children:[e.jsx(m,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(x,{...k("email"),type:"email",placeholder:"Enter email address",className:"pl-10",disabled:b||g})]}),C.email&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:C.email.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Phone Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(x,{...k("phone"),type:"tel",placeholder:"Enter phone number",className:"pl-10",disabled:b||g})]}),C.phone&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:C.phone.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(x,{...k("address"),placeholder:"Enter address",className:"pl-10",disabled:b||g})]}),C.address&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:C.address.message})]})]})]}),e.jsxs(i,{children:[e.jsx(d,{children:e.jsxs(n,{className:"flex items-center text-lg",children:[e.jsx(u,{className:"w-5 h-5 mr-2 text-primary"}),"Status & Notes"]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Status"}),e.jsxs("select",{...k("status"),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:b||g,children:[e.jsx("option",{value:"lead",children:"Lead"}),e.jsx("option",{value:"prospect",children:"Prospect"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"churned",children:"Churned"})]}),C.status&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:C.status.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Notes"}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{className:"absolute left-3 top-3 text-slate-400 w-4 h-4"}),e.jsx("textarea",{...k("notes"),rows:4,className:"w-full px-3 py-2 pl-10 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 resize-none",placeholder:"Enter any additional notes...",disabled:b||g})]}),C.notes&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:C.notes.message})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx(l,{type:"button",variant:"outline",onClick:v,disabled:b||g,children:"Cancel"}),e.jsx(l,{type:"submit",className:"bg-gradient-to-r from-primary to-primary-600 hover:from-primary-600 hover:to-primary-700",disabled:b||g,children:b||g?e.jsx(N,{size:"sm",color:"white"}):e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),s?"Update Client":"Create Client"]})})]})]})]})}const M={lead:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300",prospect:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300",active:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300",churned:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300"},Q={lead:"Lead",prospect:"Prospect",active:"Active",churned:"Churned"};function R(){const{isAuthenticated:r}=v(),[u,p]=a.useState(""),[f,z]=a.useState("all"),[E,P]=a.useState(!1),[q,F]=a.useState(null),[G,R]=a.useState(null),[H,J]=a.useState(!1),O=s(),{data:U,isLoading:Y,error:_}=I(),W=T(),X=B(),Z=V();$(e=>{O.invalidateQueries({queryKey:["clients"]}),O.invalidateQueries({queryKey:["clientStats"]})});const ee=a.useMemo(()=>U?U.filter(e=>{var s;const a=e.name.toLowerCase().includes(u.toLowerCase())||e.email.toLowerCase().includes(u.toLowerCase())||(null==(s=e.phone)?void 0:s.toLowerCase().includes(u.toLowerCase())),t="all"===f||e.status===f;return a&&t}):[],[U,u,f]);return r?Y?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(N,{size:"lg",text:"Loading clients..."})}):_?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mb-2",children:"Error Loading Clients"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:_.message||"Failed to load clients. Please try again."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold gradient-text",children:"Clients"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Manage your client relationships and track their progress"})]}),e.jsxs(l,{onClick:()=>P(!0),className:"mt-4 sm:mt-0 bg-gradient-to-r from-primary to-primary-600 hover:from-primary-600 hover:to-primary-700 button-glow hover-lift",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"Add Client"]})]}),e.jsx(i,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(x,{placeholder:"Search clients by name, email, or phone...",value:u,onChange:e=>p(e.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:f,onChange:e=>z(e.target.value),className:"px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"lead",children:"Leads"}),e.jsx("option",{value:"prospect",children:"Prospects"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"churned",children:"Churned"})]})})]})})}),0===ee.length?e.jsx(i,{children:e.jsxs(o,{className:"p-12 text-center",children:[e.jsx(c,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100 mb-2",children:u||"all"!==f?"No clients found":"No clients yet"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:u||"all"!==f?"Try adjusting your search or filter criteria.":"Get started by adding your first client."}),!u&&"all"===f&&e.jsxs(l,{onClick:()=>P(!0),className:"bg-gradient-to-r from-primary to-primary-600 hover:from-primary-600 hover:to-primary-700",children:[e.jsx(g,{className:"w-4 h-4 mr-2"}),"Add Your First Client"]})]})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:ee.map(s=>e.jsxs(i,{className:"card-hover group",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(n,{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 group-hover:text-primary transition-colors",children:s.name}),e.jsx("div",{className:"flex items-center mt-1",children:e.jsx(y,{className:`${M[s.status]} text-xs font-medium`,children:Q[s.status]})})]}),e.jsx("div",{className:"relative",children:e.jsx(l,{variant:"ghost",size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(k,{className:"w-4 h-4"})})})]})}),e.jsxs(o,{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-slate-600 dark:text-slate-400",children:[e.jsx(m,{className:"w-4 h-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex items-center text-sm text-slate-600 dark:text-slate-400",children:[e.jsx(h,{className:"w-4 h-4 mr-2 flex-shrink-0"}),e.jsx("span",{children:s.phone})]}),s.address&&e.jsxs("div",{className:"flex items-center text-sm text-slate-600 dark:text-slate-400",children:[e.jsx(j,{className:"w-4 h-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.address})]})]}),s.notes&&e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 bg-slate-50 dark:bg-slate-800 p-3 rounded-lg",children:e.jsx("p",{className:"line-clamp-2",children:s.notes})}),e.jsxs("div",{className:"flex items-center text-xs text-slate-500 dark:text-slate-400",children:[e.jsx(w,{className:"w-3 h-3 mr-1"}),e.jsxs("span",{children:["Added ",C(s.created_at)]})]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t border-slate-200 dark:border-slate-700",children:[e.jsxs(l,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>F(s),children:[e.jsx(S,{className:"w-3 h-3 mr-1"}),"Edit"]}),e.jsx(l,{variant:"outline",size:"sm",className:"flex-1",asChild:!0,children:e.jsxs(t,{to:`/clients/${s.id}`,children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"View"]})}),e.jsx(l,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-900/20",onClick:()=>(e=>{R(e),J(!0)})(s),children:e.jsx(L,{className:"w-3 h-3"})})]})]})]},s.id))}),E&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(K,{client:null,onSave:async e=>{try{await W.mutateAsync(e),P(!1)}catch(s){}},onCancel:()=>P(!1),isLoading:W.isPending})})}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsx(K,{client:q,onSave:async e=>{if(q)try{await X.mutateAsync({id:q.id,...e}),F(null)}catch(s){}},onCancel:()=>F(null),isLoading:X.isPending})})}),e.jsx(D,{isOpen:H,onClose:()=>J(!1),onConfirm:async()=>{if(G)try{await Z.mutateAsync(G.id),R(null),J(!1)}catch(e){}},title:"Delete Client",message:`Are you sure you want to delete ${null==G?void 0:G.name}? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",variant:"destructive"})]}):e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:"Authentication Required"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Please sign in to view clients."}),e.jsx(l,{asChild:!0,children:e.jsx(t,{to:"/auth/login",children:"Sign In"})})]})})}export{R as ClientsPage};
