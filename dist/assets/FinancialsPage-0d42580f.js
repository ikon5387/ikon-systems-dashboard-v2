var e=Object.defineProperty,t=(t,s,a)=>(((t,s,a)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a})(t,"symbol"!=typeof s?s+"":s,a),a);import{j as s,b as a,u as r,c as n}from"./query-9fe77bbe.js";import{r as l}from"./vendor-5e66fe52.js";import{L as i}from"./router-d215a13b.js";import{B as c,w as d,C as o,a as m,b as u,z as x,c as h,h as v,I as p,p as g,i as j,o as f,J as b,L as y,M as N,n as _,u as w,j as k,k as S,l as I,N as C,O as q,Z as D,t as F,H as T,G as O,f as L,_ as A,$ as P,Q as z,R as E}from"./index-654029b0.js";import{o as $,s as Q,e as K,a as R,n as G,u as M}from"./forms-1427850a.js";import{t as B}from"./zod-7016e973.js";import{a as U}from"./useClients-84110019.js";import{C as V}from"./ConfirmDialog-287d4948.js";import{B as Y}from"./BaseService-e2aecc13.js";import"./supabase-e62705ad.js";import"./icons-9f4f2400.js";const H=$({client_id:Q().min(1,"Client is required"),invoice_number:Q().min(1,"Invoice number is required"),issue_date:Q().min(1,"Issue date is required"),due_date:Q().min(1,"Due date is required"),status:K(["draft","sent","paid","overdue","cancelled"]).default("draft"),items:R($({description:Q().min(1,"Description is required"),quantity:G().min(1,"Quantity must be at least 1"),unit_price:G().min(0,"Unit price must be positive"),total:G().min(0,"Total must be positive")})).min(1,"At least one item is required"),subtotal:G().min(0,"Subtotal must be positive"),tax_rate:G().min(0).max(100,"Tax rate cannot exceed 100%"),tax_amount:G().min(0,"Tax amount must be positive"),total_amount:G().min(0,"Total amount must be positive"),notes:Q().optional()});function J({invoice:e,onSave:t,onCancel:a,isLoading:r=!1}){const[n,i]=l.useState(!1),{data:N}=U(),{register:_,handleSubmit:w,formState:{errors:k},reset:S,setValue:I,watch:C}=M({resolver:B(H),defaultValues:{client_id:"",invoice_number:"",issue_date:(new Date).toISOString().split("T")[0],due_date:new Date(Date.now()+2592e6).toISOString().split("T")[0],status:"draft",items:[{description:"",quantity:1,unit_price:0,total:0}],subtotal:0,tax_rate:0,tax_amount:0,total_amount:0,notes:""}}),q=C("items"),D=C("tax_rate");l.useEffect(()=>{e&&S({client_id:e.client_id||"",invoice_number:e.invoice_number||"",issue_date:e.issue_date||(new Date).toISOString().split("T")[0],due_date:e.due_date||new Date(Date.now()+2592e6).toISOString().split("T")[0],status:e.status||"draft",items:e.items||[{description:"",quantity:1,unit_price:0,total:0}],subtotal:e.subtotal||0,tax_rate:e.tax_rate||0,tax_amount:e.tax_amount||0,total_amount:e.total_amount||0,notes:e.notes||""})},[e,S]),l.useEffect(()=>{const e=q.reduce((e,t)=>e+t.quantity*t.unit_price,0),t=e*D/100,s=e+t;I("subtotal",e),I("tax_amount",t),I("total_amount",s)},[q,D,I]);const F=(e,t,s)=>{const a=[...C("items")];a[e]={...a[e],[t]:s},"quantity"!==t&&"unit_price"!==t||(a[e].total=a[e].quantity*a[e].unit_price),I("items",a)};return s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:e?"Edit Invoice":"Create New Invoice"}),s.jsx(c,{variant:"ghost",size:"sm",onClick:a,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:s.jsx(d,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:w(async e=>{var s;i(!0);try{const a={invoice_number:e.invoice_number,client_id:e.client_id,title:(null==(s=e.items[0])?void 0:s.description)||"Invoice",description:e.notes||null,amount:e.subtotal,tax_rate:e.tax_rate,total_amount:e.total_amount,status:e.status,due_date:e.due_date,notes:e.notes||null};await t(a)}catch(a){}finally{i(!1)}}),className:"space-y-6",children:[s.jsxs(o,{children:[s.jsx(m,{children:s.jsxs(u,{className:"flex items-center text-lg",children:[s.jsx(x,{className:"w-5 h-5 mr-2 text-primary"}),"Basic Information"]})}),s.jsxs(h,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Client *"}),s.jsxs("div",{className:"relative",children:[s.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),s.jsxs("select",{..._("client_id"),className:"w-full pl-10 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:n||r,children:[s.jsx("option",{value:"",children:"Select a client"}),null==N?void 0:N.map(e=>s.jsxs("option",{value:e.id,children:[e.name," (",e.email,")"]},e.id))]})]}),k.client_id&&s.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:k.client_id.message})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Invoice Number *"}),s.jsx(p,{..._("invoice_number"),placeholder:"INV-001",disabled:n||r}),k.invoice_number&&s.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:k.invoice_number.message})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Issue Date *"}),s.jsxs("div",{className:"relative",children:[s.jsx(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),s.jsx(p,{..._("issue_date"),type:"date",className:"pl-10",disabled:n||r})]}),k.issue_date&&s.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:k.issue_date.message})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Due Date *"}),s.jsxs("div",{className:"relative",children:[s.jsx(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),s.jsx(p,{..._("due_date"),type:"date",className:"pl-10",disabled:n||r})]}),k.due_date&&s.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:k.due_date.message})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Status"}),s.jsxs("select",{..._("status"),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:n||r,children:[s.jsx("option",{value:"draft",children:"Draft"}),s.jsx("option",{value:"sent",children:"Sent"}),s.jsx("option",{value:"paid",children:"Paid"}),s.jsx("option",{value:"overdue",children:"Overdue"}),s.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]})]}),s.jsxs(o,{children:[s.jsx(m,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(u,{className:"flex items-center text-lg",children:[s.jsx(j,{className:"w-5 h-5 mr-2 text-primary"}),"Invoice Items"]}),s.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e=C("items");I("items",[...e,{description:"",quantity:1,unit_price:0,total:0}])},disabled:n||r,children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"Add Item"]})]})}),s.jsxs(h,{className:"space-y-4",children:[q.map((e,t)=>s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 p-4 border border-slate-200 dark:border-slate-700 rounded-lg",children:[s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Description"}),s.jsx(p,{value:e.description,onChange:e=>F(t,"description",e.target.value),placeholder:"Item description",disabled:n||r})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Quantity"}),s.jsx(p,{type:"number",min:"1",value:e.quantity,onChange:e=>F(t,"quantity",parseInt(e.target.value)||1),disabled:n||r})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Unit Price"}),s.jsx(p,{type:"number",min:"0",step:"0.01",value:e.unit_price,onChange:e=>F(t,"unit_price",parseFloat(e.target.value)||0),disabled:n||r})]}),s.jsxs("div",{className:"flex items-end",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Total"}),s.jsx(p,{type:"number",min:"0",step:"0.01",value:e.total,readOnly:!0,className:"bg-slate-50 dark:bg-slate-800"})]}),q.length>1&&s.jsx(c,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{const t=C("items");t.length>1&&I("items",t.filter((t,s)=>s!==e))})(t),className:"ml-2 text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-900/20",disabled:n||r,children:s.jsx(b,{className:"w-4 h-4"})})]})]},t)),k.items&&s.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:k.items.message})]})]}),s.jsxs(o,{children:[s.jsx(m,{children:s.jsxs(u,{className:"flex items-center text-lg",children:[s.jsx(j,{className:"w-5 h-5 mr-2 text-primary"}),"Totals"]})}),s.jsxs(h,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Subtotal"}),s.jsx(p,{..._("subtotal",{valueAsNumber:!0}),type:"number",step:"0.01",readOnly:!0,className:"bg-slate-50 dark:bg-slate-800"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Tax Rate (%)"}),s.jsx(p,{..._("tax_rate",{valueAsNumber:!0}),type:"number",min:"0",max:"100",step:"0.01",placeholder:"0",disabled:n||r})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Tax Amount"}),s.jsx(p,{..._("tax_amount",{valueAsNumber:!0}),type:"number",step:"0.01",readOnly:!0,className:"bg-slate-50 dark:bg-slate-800"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Total Amount"}),s.jsx(p,{..._("total_amount",{valueAsNumber:!0}),type:"number",step:"0.01",readOnly:!0,className:"bg-slate-50 dark:bg-slate-800 font-semibold"})]})]})]})]}),s.jsxs(o,{children:[s.jsx(m,{children:s.jsxs(u,{className:"flex items-center text-lg",children:[s.jsx(x,{className:"w-5 h-5 mr-2 text-primary"}),"Notes"]})}),s.jsx(h,{children:s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Additional Notes"}),s.jsx("textarea",{..._("notes"),rows:4,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 resize-none",placeholder:"Any additional notes or terms...",disabled:n||r})]})})]}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-slate-200 dark:border-slate-700",children:[s.jsx(c,{type:"button",variant:"outline",onClick:a,disabled:n||r,children:"Cancel"}),s.jsx(c,{type:"submit",className:"bg-gradient-to-r from-primary to-primary-600 hover:from-primary-600 hover:to-primary-700",disabled:n||r,children:n||r?s.jsx(y,{size:"sm",color:"white"}):s.jsxs(s.Fragment,{children:[s.jsx(x,{className:"w-4 h-4 mr-2"}),e?"Update Invoice":"Create Invoice"]})})]})]})]})}const Z=new class extends Y{constructor(){super(...arguments),t(this,"tableName","invoices")}async getInvoices(e,t){try{let s=N.from("invoices").select("\n          *,\n          clients (\n            id,\n            name,\n            email\n          )\n        ").order("created_at",{ascending:!1});if(e&&(e.status&&(s=s.eq("status",e.status)),e.client_id&&(s=s.eq("client_id",e.client_id)),e.date_from&&(s=s.gte("created_at",e.date_from)),e.date_to&&(s=s.lte("created_at",e.date_to)),e.amount_min&&(s=s.gte("total_amount",e.amount_min)),e.amount_max&&(s=s.lte("total_amount",e.amount_max))),t){const{page:e=1,limit:a=10}=t,r=(e-1)*a,n=r+a-1;s=s.range(r,n)}const{data:a,error:r}=await s;return r?{data:null,error:r.message,success:!1}:{data:a||[],error:null,success:!0}}catch(s){return{data:null,error:"Failed to fetch invoices",success:!1}}}async getInvoice(e){try{const{data:t,error:s}=await N.from("invoices").select("\n          *,\n          clients (\n            id,\n            name,\n            email,\n            phone,\n            address\n          )\n        ").eq("id",e).single();return s?{data:null,error:s.message,success:!1}:{data:t,error:null,success:!0}}catch(t){return{data:null,error:"Failed to fetch invoice",success:!1}}}async createInvoice(e){try{const{data:t,error:s}=await N.from("invoices").insert(e).select().single();return s?{data:null,error:s.message,success:!1}:{data:t,error:null,success:!0}}catch(t){return{data:null,error:"Failed to create invoice",success:!1}}}async updateInvoice(e,t){try{const{data:s,error:a}=await N.from("invoices").update({...t,updated_at:(new Date).toISOString()}).eq("id",e).select().single();return a?{data:null,error:a.message,success:!1}:{data:s,error:null,success:!0}}catch(s){return{data:null,error:"Failed to update invoice",success:!1}}}async deleteInvoice(e){try{const{error:t}=await N.from("invoices").delete().eq("id",e);return t?{data:null,error:t.message,success:!1}:{data:!0,error:null,success:!0}}catch(t){return{data:null,error:"Failed to delete invoice",success:!1}}}async getPayments(e,t){try{let s=N.from("payments").select("\n          *,\n          invoices (\n            id,\n            invoice_number,\n            total_amount\n          ),\n          clients (\n            id,\n            name,\n            email\n          )\n        ").order("created_at",{ascending:!1});if(e&&(e.client_id&&(s=s.eq("client_id",e.client_id)),e.date_from&&(s=s.gte("payment_date",e.date_from)),e.date_to&&(s=s.lte("payment_date",e.date_to)),e.amount_min&&(s=s.gte("amount",e.amount_min)),e.amount_max&&(s=s.lte("amount",e.amount_max))),t){const{page:e=1,limit:a=10}=t,r=(e-1)*a,n=r+a-1;s=s.range(r,n)}const{data:a,error:r}=await s;return r?{data:null,error:r.message,success:!1}:{data:a||[],error:null,success:!0}}catch(s){return{data:null,error:"Failed to fetch payments",success:!1}}}async createPayment(e){try{const{data:t,error:s}=await N.from("payments").insert(e).select().single();if(s)return{data:null,error:s.message,success:!1};if(e.invoice_id){const{data:t}=await N.from("invoices").select("total_amount").eq("id",e.invoice_id).single();if(t){const{data:s}=await N.from("payments").select("amount").eq("invoice_id",e.invoice_id);((null==s?void 0:s.reduce((e,t)=>e+t.amount,0))||0)>=t.total_amount&&await N.from("invoices").update({status:"paid",updated_at:(new Date).toISOString()}).eq("id",e.invoice_id)}}return{data:t,error:null,success:!0}}catch(t){return{data:null,error:"Failed to create payment",success:!1}}}async getExpenses(e,t){try{let s=N.from("expenses").select("*").order("created_at",{ascending:!1});if(e&&(e.date_from&&(s=s.gte("expense_date",e.date_from)),e.date_to&&(s=s.lte("expense_date",e.date_to)),e.amount_min&&(s=s.gte("amount",e.amount_min)),e.amount_max&&(s=s.lte("amount",e.amount_max))),t){const{page:e=1,limit:a=10}=t,r=(e-1)*a,n=r+a-1;s=s.range(r,n)}const{data:a,error:r}=await s;return r?{data:null,error:r.message,success:!1}:{data:a||[],error:null,success:!0}}catch(s){return{data:null,error:"Failed to fetch expenses",success:!1}}}async createExpense(e){try{const{data:t,error:s}=await N.from("expenses").insert(e).select().single();return s?{data:null,error:s.message,success:!1}:{data:t,error:null,success:!0}}catch(t){return{data:null,error:"Failed to create expense",success:!1}}}async getFinancialStats(){try{const e=new Date,t=e.toISOString().slice(0,7),s=new Date(e.getFullYear(),e.getMonth()-1,1).toISOString().slice(0,7),{data:a}=await N.from("payments").select("amount"),r=(null==a?void 0:a.reduce((e,t)=>e+t.amount,0))||0,{data:n}=await N.from("expenses").select("amount"),l=(null==n?void 0:n.reduce((e,t)=>e+t.amount,0))||0,{data:i}=await N.from("invoices").select("total_amount").in("status",["sent","overdue"]),c=(null==i?void 0:i.reduce((e,t)=>e+t.total_amount,0))||0,{data:d}=await N.from("invoices").select("total_amount").eq("status","overdue"),o=(null==d?void 0:d.reduce((e,t)=>e+t.total_amount,0))||0,{data:m}=await N.from("payments").select("amount").gte("payment_date",`${t}-01`).lt("payment_date",`${t}-32`),u=(null==m?void 0:m.reduce((e,t)=>e+t.amount,0))||0,{data:x}=await N.from("expenses").select("amount").gte("expense_date",`${t}-01`).lt("expense_date",`${t}-32`),h=(null==x?void 0:x.reduce((e,t)=>e+t.amount,0))||0,{data:v}=await N.from("payments").select("amount").gte("payment_date",`${s}-01`).lt("payment_date",`${s}-32`),p=(null==v?void 0:v.reduce((e,t)=>e+t.amount,0))||0,{data:g}=await N.from("expenses").select("amount").gte("expense_date",`${s}-01`).lt("expense_date",`${s}-32`),j=(null==g?void 0:g.reduce((e,t)=>e+t.amount,0))||0;return{data:{totalRevenue:r,totalExpenses:l,netProfit:r-l,outstandingInvoices:c,overdueInvoices:o,monthlyRevenue:u,monthlyExpenses:h,revenueGrowth:p>0?(u-p)/p*100:0,expenseGrowth:j>0?(h-j)/j*100:0},error:null,success:!0}}catch(e){return{data:null,error:"Failed to fetch financial stats",success:!1}}}async getRevenueData(e=12){try{const t=[],s=new Date;for(let a=e-1;a>=0;a--){const e=new Date(s.getFullYear(),s.getMonth()-a,1),r=e.toISOString().slice(0,7),n=new Date(e.getFullYear(),e.getMonth()+1,1).toISOString().slice(0,7),{data:l}=await N.from("payments").select("amount").gte("payment_date",`${r}-01`).lt("payment_date",`${n}-01`),i=(null==l?void 0:l.reduce((e,t)=>e+t.amount,0))||0,{data:c}=await N.from("expenses").select("amount").gte("expense_date",`${r}-01`).lt("expense_date",`${n}-01`),d=(null==c?void 0:c.reduce((e,t)=>e+t.amount,0))||0;t.push({month:e.toLocaleDateString("en-US",{month:"short",year:"numeric"}),revenue:i,expenses:d,profit:i-d})}return{data:t,error:null,success:!0}}catch(t){return{data:null,error:"Failed to fetch revenue data",success:!1}}}subscribeToInvoices(e){return N.channel("invoices_changes").on("postgres_changes",{event:"*",schema:"public",table:"invoices"},e).subscribe()}subscribeToPayments(e){return N.channel("payments_changes").on("postgres_changes",{event:"*",schema:"public",table:"payments"},e).subscribe()}subscribeToExpenses(e){return N.channel("expenses_changes").on("postgres_changes",{event:"*",schema:"public",table:"expenses"},e).subscribe()}},W={all:["financials"],invoices:()=>[...W.all,"invoices"],invoiceList:e=>[...W.invoices(),{filters:e}],invoiceDetail:e=>[...W.invoices(),"detail",e],payments:()=>[...W.all,"payments"],paymentList:e=>[...W.payments(),{filters:e}],expenses:()=>[...W.all,"expenses"],expenseList:e=>[...W.expenses(),{filters:e}],stats:()=>[...W.all,"stats"],revenueData:e=>[...W.all,"revenue",e]};const X={draft:"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300",sent:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300",paid:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300",overdue:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300",cancelled:"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300"},ee={draft:"Draft",sent:"Sent",paid:"Paid",overdue:"Overdue",cancelled:"Cancelled"},te={draft:x,sent:P,paid:z,overdue:q,cancelled:E};function se(){const{isAuthenticated:e}=w(),[t,d]=l.useState(""),[v,N]=l.useState("all"),[P,z]=l.useState(!1),[E,$]=l.useState(null),[Q,K]=l.useState(null),[R,G]=l.useState(!1),{data:M,isLoading:B,error:U}=a({queryKey:W.invoiceList(Y),queryFn:()=>Z.getInvoices(Y),select:e=>e.data||[],staleTime:3e5});var Y;const{data:H}=a({queryKey:W.stats(),queryFn:()=>Z.getFinancialStats(),select:e=>e.data,staleTime:12e4,refetchInterval:3e5}),se=function(){const e=r();return n({mutationFn:e=>Z.createInvoice(e),onSuccess:t=>{t.data?(e.invalidateQueries({queryKey:W.invoices()}),e.invalidateQueries({queryKey:W.stats()}),e.invalidateQueries({queryKey:W.revenueData(12)}),_.success("Invoice created successfully!")):_.error(t.error||"Failed to create invoice")},onError:e=>{_.error("Failed to create invoice")}})}(),ae=function(){const e=r();return n({mutationFn:({id:e,...t})=>Z.updateInvoice(e,t),onSuccess:(t,s)=>{t.data?(e.setQueryData(W.invoiceDetail(s.id),t.data),e.invalidateQueries({queryKey:W.invoices()}),e.invalidateQueries({queryKey:W.stats()}),e.invalidateQueries({queryKey:W.revenueData(12)}),_.success("Invoice updated successfully!")):_.error(t.error||"Failed to update invoice")},onError:e=>{_.error("Failed to update invoice")}})}(),re=function(){const e=r();return n({mutationFn:e=>Z.deleteInvoice(e),onSuccess:(t,s)=>{t.data?(e.removeQueries({queryKey:W.invoiceDetail(s)}),e.invalidateQueries({queryKey:W.invoices()}),e.invalidateQueries({queryKey:W.stats()}),e.invalidateQueries({queryKey:W.revenueData(12)}),_.success("Invoice deleted successfully!")):_.error(t.error||"Failed to delete invoice")},onError:e=>{_.error("Failed to delete invoice")}})}(),ne=l.useMemo(()=>M?M.filter(e=>{var s,a,r,n,l;const i=(null==(s=e.invoice_number)?void 0:s.toLowerCase().includes(t.toLowerCase()))||(null==(r=null==(a=e.clients)?void 0:a.name)?void 0:r.toLowerCase().includes(t.toLowerCase()))||(null==(l=null==(n=e.clients)?void 0:n.email)?void 0:l.toLowerCase().includes(t.toLowerCase())),c="all"===v||e.status===v;return i&&c}):[],[M,t,v]);return e?B?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsx(y,{size:"lg",text:"Loading financial data..."})}):U?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mb-2",children:"Error Loading Financial Data"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:U.message||"Failed to load financial data. Please try again."})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold gradient-text",children:"Financials"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Manage invoices, payments, and track your business finances"})]}),s.jsxs(c,{onClick:()=>z(!0),className:"mt-4 sm:mt-0 bg-gradient-to-r from-primary to-primary-600 hover:from-primary-600 hover:to-primary-700 button-glow hover-lift",children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"Create Invoice"]})]}),H&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsxs(o,{className:"card-hover bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 border-green-200 dark:border-green-700",children:[s.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(u,{className:"text-sm font-medium text-green-700 dark:text-green-300",children:"Total Revenue"}),s.jsx("div",{className:"w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center",children:s.jsx(j,{className:"h-5 w-5 text-white"})})]}),s.jsxs(h,{children:[s.jsx("div",{className:"text-3xl font-bold text-green-900 dark:text-green-100",children:k(H.totalRevenue)}),s.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 flex items-center mt-1",children:[s.jsx(S,{className:"w-3 h-3 mr-1"}),s.jsxs("span",{className:"text-green-600 dark:text-green-400 font-medium",children:["+",H.revenueGrowth.toFixed(1),"%"]})," this month"]})]})]}),s.jsxs(o,{className:"card-hover bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 border-red-200 dark:border-red-700",children:[s.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(u,{className:"text-sm font-medium text-red-700 dark:text-red-300",children:"Total Expenses"}),s.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center",children:s.jsx(x,{className:"h-5 w-5 text-white"})})]}),s.jsxs(h,{children:[s.jsx("div",{className:"text-3xl font-bold text-red-900 dark:text-red-100",children:k(H.totalExpenses)}),s.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 flex items-center mt-1",children:[s.jsx(I,{className:"w-3 h-3 mr-1"}),s.jsxs("span",{className:"text-red-600 dark:text-red-400 font-medium",children:[H.expenseGrowth.toFixed(1),"%"]})," this month"]})]})]}),s.jsxs(o,{className:"card-hover bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 border-blue-200 dark:border-blue-700",children:[s.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(u,{className:"text-sm font-medium text-blue-700 dark:text-blue-300",children:"Net Profit"}),s.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center",children:s.jsx(S,{className:"h-5 w-5 text-white"})})]}),s.jsxs(h,{children:[s.jsx("div",{className:"text-3xl font-bold text-blue-900 dark:text-blue-100",children:k(H.netProfit)}),s.jsxs("p",{className:"text-xs text-blue-600 dark:text-blue-400 flex items-center mt-1",children:[s.jsx(S,{className:"w-3 h-3 mr-1"}),s.jsx("span",{className:"text-green-600 dark:text-green-400 font-medium",children:H.netProfit>0?"Profitable":"Loss"})]})]})]}),s.jsxs(o,{className:"card-hover bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 border-orange-200 dark:border-orange-700",children:[s.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(u,{className:"text-sm font-medium text-orange-700 dark:text-orange-300",children:"Outstanding"}),s.jsx("div",{className:"w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center",children:s.jsx(C,{className:"h-5 w-5 text-white"})})]}),s.jsxs(h,{children:[s.jsx("div",{className:"text-3xl font-bold text-orange-900 dark:text-orange-100",children:k(H.outstandingInvoices)}),s.jsxs("p",{className:"text-xs text-orange-600 dark:text-orange-400 flex items-center mt-1",children:[s.jsx(q,{className:"w-3 h-3 mr-1"}),s.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",children:k(H.overdueInvoices)})," overdue"]})]})]})]}),s.jsx(o,{children:s.jsx(h,{className:"p-6",children:s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"relative",children:[s.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),s.jsx(p,{placeholder:"Search invoices by number, client name, or email...",value:t,onChange:e=>d(e.target.value),className:"pl-10"})]})}),s.jsx("div",{className:"flex gap-2",children:s.jsxs("select",{value:v,onChange:e=>N(e.target.value),className:"px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"draft",children:"Draft"}),s.jsx("option",{value:"sent",children:"Sent"}),s.jsx("option",{value:"paid",children:"Paid"}),s.jsx("option",{value:"overdue",children:"Overdue"}),s.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]})})}),0===ne.length?s.jsx(o,{children:s.jsxs(h,{className:"p-12 text-center",children:[s.jsx(x,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100 mb-2",children:t||"all"!==v?"No invoices found":"No invoices yet"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:t||"all"!==v?"Try adjusting your search or filter criteria.":"Get started by creating your first invoice."}),!t&&"all"===v&&s.jsxs(c,{onClick:()=>z(!0),className:"bg-gradient-to-r from-primary to-primary-600 hover:from-primary-600 hover:to-primary-700",children:[s.jsx(f,{className:"w-4 h-4 mr-2"}),"Create Your First Invoice"]})]})}):s.jsx("div",{className:"grid grid-cols-1 gap-6",children:ne.map(e=>{var t;const a=te[e.status];return s.jsxs(o,{className:"card-hover group",children:[s.jsx(m,{className:"pb-3",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx(u,{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 group-hover:text-primary transition-colors",children:e.invoice_number}),s.jsxs("div",{className:"flex items-center mt-1 space-x-2",children:[s.jsxs(F,{className:`${X[e.status]} text-xs font-medium flex items-center`,children:[s.jsx(a,{className:"w-3 h-3 mr-1"}),ee[e.status]]}),s.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:k(e.total_amount)})]})]}),s.jsx("div",{className:"relative",children:s.jsx(c,{variant:"ghost",size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsx(T,{className:"w-4 h-4"})})})]})}),s.jsxs(h,{className:"space-y-3",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center text-sm text-slate-600 dark:text-slate-400",children:[s.jsx(x,{className:"w-4 h-4 mr-2 flex-shrink-0"}),s.jsx("span",{className:"font-medium",children:null==(t=e.clients)?void 0:t.name})]}),s.jsxs("div",{className:"flex items-center text-sm text-slate-600 dark:text-slate-400",children:[s.jsx(g,{className:"w-4 h-4 mr-2 flex-shrink-0"}),s.jsxs("span",{children:["Due ",O(e.due_date)]})]})]}),e.notes&&s.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 bg-slate-50 dark:bg-slate-800 p-3 rounded-lg",children:s.jsx("p",{className:"line-clamp-2",children:e.notes})}),s.jsxs("div",{className:"flex items-center text-xs text-slate-500 dark:text-slate-400",children:[s.jsx(g,{className:"w-3 h-3 mr-1"}),s.jsxs("span",{children:["Created ",O(e.created_at)]})]}),s.jsxs("div",{className:"flex gap-2 pt-2 border-t border-slate-200 dark:border-slate-700",children:[s.jsxs(c,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>$(e),children:[s.jsx(T,{className:"w-3 h-3 mr-1"}),"Edit"]}),s.jsx(c,{variant:"outline",size:"sm",className:"flex-1",asChild:!0,children:s.jsxs(i,{to:`/financials/invoices/${e.id}`,children:[s.jsx(L,{className:"w-3 h-3 mr-1"}),"View"]})}),s.jsx(c,{variant:"outline",size:"sm",className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 dark:text-blue-400 dark:hover:text-blue-300 dark:hover:bg-blue-900/20",children:s.jsx(A,{className:"w-3 h-3"})}),s.jsx(c,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-900/20",onClick:()=>(e=>{K(e),G(!0)})(e),children:s.jsx(b,{className:"w-3 h-3"})})]})]})]},e.id)})}),P&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:s.jsx(J,{invoice:null,onSave:async e=>{try{await se.mutateAsync(e),z(!1)}catch(t){}},onCancel:()=>z(!1),isLoading:se.isPending})})}),E&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:s.jsx(J,{invoice:E,onSave:async e=>{if(E)try{await ae.mutateAsync({id:E.id,...e}),$(null)}catch(t){}},onCancel:()=>$(null),isLoading:ae.isPending})})}),s.jsx(V,{isOpen:R,onClose:()=>G(!1),onConfirm:async()=>{if(Q)try{await re.mutateAsync(Q.id),K(null),G(!1)}catch(e){}},title:"Delete Invoice",message:"Are you sure you want to delete this invoice? This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",variant:"destructive"})]}):s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:"Authentication Required"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Please sign in to view financial data."}),s.jsx(c,{asChild:!0,children:s.jsx(i,{to:"/auth/login",children:"Sign In"})})]})})}export{se as FinancialsPage};
