var e=Object.defineProperty,r=(r,t,n)=>(((r,t,n)=>{t in r?e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[t]=n})(r,"symbol"!=typeof t?t+"":t,n),n);import{n as t,M as n}from"./index-654029b0.js";class s extends Error{constructor(e,t,n){super(e),r(this,"code"),r(this,"details"),r(this,"timestamp"),this.name="AppError",this.code=t,this.details=n,this.timestamp=new Date}}class a extends s{constructor(e="Network request failed",r){super(e,"NETWORK_ERROR",r),this.name="NetworkError"}}class o extends s{constructor(e="Validation failed",r){super(e,"VALIDATION_ERROR",r),this.name="ValidationError"}}class i extends s{constructor(e="Authentication failed",r){super(e,"AUTH_ERROR",r),this.name="AuthenticationError"}}class c extends s{constructor(e="Permission denied",r){super(e,"PERMISSION_ERROR",r),this.name="PermissionError"}}const l=new class{constructor(){r(this,"errorQueue",[]),r(this,"maxQueueSize",100)}logError(e,r){const t={message:e.message,code:e instanceof s?e.code:void 0,details:e instanceof s?e.details:void 0,timestamp:new Date,userAgent:"undefined"!=typeof navigator?navigator.userAgent:void 0,url:"undefined"!=typeof window?window.location.href:void 0};r&&(t.details={...t.details,context:r}),this.errorQueue.push(t),this.errorQueue.length>this.maxQueueSize&&this.errorQueue.shift(),this.sendToSentry(t)}handleError(e,r,n=!0){this.logError(e,r),n&&(e instanceof a?t.error("Network error. Please check your connection."):e instanceof i?t.error("Authentication failed. Please sign in again."):e instanceof c?t.error("You do not have permission to perform this action."):e instanceof o?t.error(e.message):t.error(e.message||"An unexpected error occurred."))}async handleAsyncError(e,r,t=!0){try{return await e()}catch(n){const e=n instanceof Error?n:new s("Unknown error occurred");return this.handleError(e,r,t),null}}async sendToSentry(e){}getRecentErrors(e=10){return this.errorQueue.slice(-e).reverse()}clearErrors(){this.errorQueue=[]}networkError(e,r){return new a(e,r)}validationError(e,r){return new o(e,r)}authError(e,r){return new i(e,r)}permissionError(e,r){return new c(e,r)}};"undefined"!=typeof window&&(window.addEventListener("unhandledrejection",e=>{var r;l.logError(new s((null==(r=e.reason)?void 0:r.message)||"Unhandled promise rejection","UNHANDLED_REJECTION",e.reason),"Global")}),window.addEventListener("error",e=>{l.logError(new s(e.message||"Global error","GLOBAL_ERROR",{filename:e.filename,lineno:e.lineno,colno:e.colno}),"Global")}));class u{constructor(e){r(this,"tableName",""),e&&(this.tableName=e)}async handleRequest(e){try{const r=await e();if(r.error){const e=r.error.message||"Database operation failed";return l.logError(new a(e,r.error),this.tableName),t.error(e),{data:null,error:e,success:!1}}return{data:r.data,error:null,success:!0}}catch(r){const e=r instanceof Error?r:new Error("An unexpected error occurred"),n=e.message;return l.logError(e,this.tableName),t.error(n),{data:null,error:n,success:!1}}}buildQuery(e,r){let t=n.from(this.tableName).select("*");if(e&&Object.entries(e).forEach(([e,r])=>{if(null!=r&&""!==r)if("string"==typeof r&&e.endsWith("_search")){const n=e.replace("_search","");t=t.ilike(n,`%${r}%`)}else t=t.eq(e,r)}),r){const{page:e,limit:n,sortBy:s="created_at",sortOrder:a="desc"}=r,o=(e-1)*n,i=o+n-1;t=t.order(s,{ascending:"asc"===a}).range(o,i)}return t}async findById(e){return this.handleRequest(async()=>await n.from(this.tableName).select("*").eq("id",e).single())}async findAll(e,r){return this.handleRequest(async()=>await this.buildQuery(e,r))}async create(e){return this.handleRequest(async()=>await n.from(this.tableName).insert(e).select().single())}async update(e,r){return this.handleRequest(async()=>await n.from(this.tableName).update(r).eq("id",e).select().single())}async delete(e){return this.handleRequest(async()=>await n.from(this.tableName).delete().eq("id",e))}async count(e){return this.handleRequest(async()=>{let r=n.from(this.tableName).select("*",{count:"exact",head:!0});return e&&Object.entries(e).forEach(([e,t])=>{null!=t&&""!==t&&(r=r.eq(e,t))}),await r})}}export{u as B};
