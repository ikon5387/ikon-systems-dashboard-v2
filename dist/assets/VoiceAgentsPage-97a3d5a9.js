var e=Object.defineProperty,a=(a,s,t)=>(((a,s,t)=>{s in a?e(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t})(a,"symbol"!=typeof s?s+"":s,t),t);import{j as s,b as t,u as r,c as l}from"./query-9fe77bbe.js";import{r as n}from"./vendor-5e66fe52.js";import{L as i}from"./router-d215a13b.js";import{B as o,w as c,S as d,I as u,T as m,N as x,U as g,L as h,A as p,M as b,n as v,u as f,o as y,C as j,c as N,D as k,V as w,a as _,b as A,t as S,E as C,W as I,v as F,H as V,f as q,P as T,X as D,J as L,Q as E,s as M,R as z}from"./index-654029b0.js";import{o as H,s as Q,e as Y,n as K,l as P,u as O}from"./forms-1427850a.js";import{t as $}from"./zod-7016e973.js";import{T as B}from"./Textarea-cb271d34.js";import{C as U}from"./ConfirmDialog-287d4948.js";import{B as R}from"./BaseService-e2aecc13.js";import"./supabase-e62705ad.js";import"./icons-9f4f2400.js";const G=H({name:Q().min(1,"Name is required").max(100,"Name must be less than 100 characters"),description:Q().max(500,"Description must be less than 500 characters").optional(),type:Y(["sales","support","appointment","follow_up","custom"]),status:Y(["active","inactive","training","error"]),model:Q().min(1,"Model is required"),voice:Q().min(1,"Voice is required"),first_message:Q().min(1,"First message is required").max(500,"First message must be less than 500 characters"),system_message:Q().min(1,"System message is required").max(1e3,"System message must be less than 1000 characters"),max_duration:K().min(30,"Max duration must be at least 30 seconds").max(1800,"Max duration cannot exceed 30 minutes"),webhook_url:Q().url("Invalid webhook URL").optional().or(P("")),language:Q().min(1,"Language is required"),temperature:K().min(0,"Temperature must be at least 0").max(2,"Temperature cannot exceed 2"),max_tokens:K().min(1,"Max tokens must be at least 1").max(4e3,"Max tokens cannot exceed 4000"),notes:Q().max(1e3,"Notes must be less than 1000 characters").optional()});function W({voiceAgent:e,onSave:a,onCancel:t,isLoading:r=!1}){var l,i;const[b,v]=n.useState(!1),{register:f,handleSubmit:y,formState:{errors:j},reset:N,watch:k}=O({resolver:$(G),defaultValues:{name:"",description:"",type:"sales",status:"inactive",model:"gpt-4",voice:"alloy",first_message:"Hello! How can I help you today?",system_message:"You are a helpful AI assistant. Be professional, friendly, and helpful.",max_duration:300,webhook_url:"",language:"en",temperature:.7,max_tokens:1e3,notes:""}}),w=k("type");n.useEffect(()=>{e&&N({name:e.name,description:e.description||"",type:e.type,status:e.status,model:e.model||"gpt-4",voice:e.voice||"alloy",first_message:e.first_message||"Hello! How can I help you today?",system_message:e.system_message||"You are a helpful AI assistant.",max_duration:e.max_duration||300,webhook_url:e.webhook_url||"",language:e.language||"en",temperature:e.temperature||.7,max_tokens:e.max_tokens||1e3,notes:e.notes||""})},[e,N]);const _=[{value:"sales",label:"Sales",icon:"💰",description:"Lead generation and sales calls"},{value:"support",label:"Support",icon:"🛠️",description:"Customer support and assistance"},{value:"appointment",label:"Appointment",icon:"📅",description:"Schedule appointments and meetings"},{value:"follow_up",label:"Follow-up",icon:"🔄",description:"Follow-up calls and reminders"},{value:"custom",label:"Custom",icon:"⚙️",description:"Custom use case"}];return s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:e?"Edit Voice Agent":"Create New Voice Agent"}),s.jsx(o,{variant:"ghost",size:"sm",onClick:t,className:"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200",children:s.jsx(c,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:y(async e=>{v(!0);try{const s={...e,description:e.description||null,webhook_url:e.webhook_url||null,notes:e.notes||null};await a(s)}catch(s){}finally{v(!1)}}),className:"space-y-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 flex items-center",children:[s.jsx(d,{className:"w-5 h-5 mr-2"}),"Basic Information"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Agent Name *"}),s.jsx(u,{...f("name"),placeholder:"Enter agent name",className:j.name?"border-red-500":""}),j.name&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.name.message})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Type *"}),s.jsx("select",{...f("type"),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500",children:_.map(e=>s.jsxs("option",{value:e.value,children:[e.icon," ",e.label]},e.value))})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Description"}),s.jsx(B,{...f("description"),placeholder:"Describe the agent's purpose and use case...",rows:3,className:j.description?"border-red-500":""}),j.description&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.description.message})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Status"}),s.jsx("select",{...f("status"),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[{value:"active",label:"Active",color:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300"},{value:"inactive",label:"Inactive",color:"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300"},{value:"training",label:"Training",color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300"},{value:"error",label:"Error",color:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300"}].map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Language"}),s.jsx("select",{...f("language"),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[{value:"en",label:"English"},{value:"es",label:"Spanish"},{value:"fr",label:"French"},{value:"de",label:"German"},{value:"it",label:"Italian"},{value:"pt",label:"Portuguese"},{value:"zh",label:"Chinese"},{value:"ja",label:"Japanese"},{value:"ko",label:"Korean"}].map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 flex items-center",children:[s.jsx(m,{className:"w-5 h-5 mr-2"}),"AI Configuration"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Model *"}),s.jsx("select",{...f("model"),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[{value:"gpt-4",label:"GPT-4"},{value:"gpt-3.5-turbo",label:"GPT-3.5 Turbo"},{value:"claude-3-opus",label:"Claude 3 Opus"},{value:"claude-3-sonnet",label:"Claude 3 Sonnet"}].map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Voice *"}),s.jsx("select",{...f("voice"),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[{value:"alloy",label:"Alloy"},{value:"echo",label:"Echo"},{value:"fable",label:"Fable"},{value:"onyx",label:"Onyx"},{value:"nova",label:"Nova"},{value:"shimmer",label:"Shimmer"}].map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Temperature"}),s.jsx(u,{type:"number",step:"0.1",min:"0",max:"2",...f("temperature",{valueAsNumber:!0}),className:j.temperature?"border-red-500":""}),j.temperature&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.temperature.message})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Max Tokens"}),s.jsx(u,{type:"number",min:"1",max:"4000",...f("max_tokens",{valueAsNumber:!0}),className:j.max_tokens?"border-red-500":""}),j.max_tokens&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.max_tokens.message})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:[s.jsx(x,{className:"w-4 h-4 inline mr-1"}),"Max Duration (seconds)"]}),s.jsx(u,{type:"number",min:"30",max:"1800",...f("max_duration",{valueAsNumber:!0}),className:j.max_duration?"border-red-500":""}),j.max_duration&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.max_duration.message})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 flex items-center",children:[s.jsx(m,{className:"w-5 h-5 mr-2"}),"Messages"]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"First Message *"}),s.jsx(B,{...f("first_message"),placeholder:"The first message the agent will say when a call is answered",rows:3,className:j.first_message?"border-red-500":""}),j.first_message&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.first_message.message}),s.jsx("div",{className:"mt-2",children:s.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e={target:{value:(e=>{switch(e){case"sales":return"Hello! I'm calling from Ikon Systems. I hope I'm not catching you at a bad time. I wanted to reach out because we help businesses like yours streamline their operations and increase efficiency. Do you have a few minutes to chat?";case"support":return"Hello! This is your AI support assistant from Ikon Systems. I'm here to help you with any questions or issues you might have. How can I assist you today?";case"appointment":return"Hello! I'm calling from Ikon Systems to help you schedule an appointment. We'd love to show you how our services can benefit your business. When would be a good time for a brief consultation?";case"follow_up":return"Hello! I'm calling from Ikon Systems to follow up on our recent interaction. I wanted to check in and see how things are going. Do you have a moment to chat?";default:return"Hello! How can I help you today?"}})(w)}};f("first_message").onChange(e)},children:["Use ",null==(l=_.find(e=>e.value===w))?void 0:l.label," Template"]})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"System Message *"}),s.jsx(B,{...f("system_message"),placeholder:"Instructions for how the agent should behave",rows:4,className:j.system_message?"border-red-500":""}),j.system_message&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.system_message.message}),s.jsx("div",{className:"mt-2",children:s.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:()=>{const e={target:{value:(e=>{switch(e){case"sales":return"You are a professional sales representative. Your goal is to understand the customer's needs and present our services in a compelling way. Be consultative, not pushy. Ask qualifying questions and listen carefully to responses.";case"support":return"You are a helpful customer support representative. Your goal is to resolve customer issues quickly and efficiently. Be patient, empathetic, and solution-oriented. If you cannot resolve an issue, escalate it appropriately.";case"appointment":return"You are a professional appointment scheduler. Your goal is to find a convenient time for the customer to meet with our team. Be flexible and accommodating while maintaining our availability constraints.";case"follow_up":return"You are a professional follow-up specialist. Your goal is to check in with customers, gather feedback, and identify opportunities for continued engagement. Be friendly and genuine in your approach.";default:return"You are a helpful AI assistant. Be professional, friendly, and helpful."}})(w)}};f("system_message").onChange(e)},children:["Use ",null==(i=_.find(e=>e.value===w))?void 0:i.label," Template"]})})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 flex items-center",children:[s.jsx(g,{className:"w-5 h-5 mr-2"}),"Integration"]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Webhook URL"}),s.jsx(u,{...f("webhook_url"),placeholder:"https://your-domain.com/webhook",className:j.webhook_url?"border-red-500":""}),j.webhook_url&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.webhook_url.message}),s.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:"Optional: URL to receive call events and data"})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 flex items-center",children:[s.jsx(m,{className:"w-5 h-5 mr-2"}),"Additional Information"]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Notes"}),s.jsx(B,{...f("notes"),placeholder:"Additional notes or configuration details...",rows:3,className:j.notes?"border-red-500":""}),j.notes&&s.jsx("p",{className:"text-red-500 text-sm mt-1",children:j.notes.message})]})]}),s.jsxs("div",{className:"flex justify-end gap-3 pt-6 border-t border-slate-200 dark:border-slate-700",children:[s.jsx(o,{type:"button",variant:"outline",onClick:t,disabled:b||r,children:"Cancel"}),s.jsxs(o,{type:"submit",disabled:b||r,className:"bg-gradient-to-r from-primary to-primary-600 hover:from-primary-600 hover:to-primary-700",children:[b||r?s.jsx(h,{size:"sm",className:"mr-2"}):s.jsx(p,{className:"w-4 h-4 mr-2"}),e?"Update Agent":"Create Agent"]})]})]})]})}const J=new class extends R{constructor(){super(...arguments),a(this,"tableName","voice_agents")}async getVoiceAgents(e,a){try{let s=b.from(this.tableName).select("*").order("created_at",{ascending:!1});if(e&&(e.status&&(s=s.eq("status",e.status)),e.type&&(s=s.eq("type",e.type)),e.name_search&&(s=s.ilike("name",`%${e.name_search}%`)),e.description_search&&(s=s.ilike("description",`%${e.description_search}%`))),a){const{page:e=1,limit:t=10}=a,r=(e-1)*t,l=r+t-1;s=s.range(r,l)}const{data:t,error:r}=await s;return r?{data:null,error:r.message,success:!1}:{data:t||[],error:null,success:!0}}catch(s){return{data:null,error:"Failed to fetch voice agents",success:!1}}}async getVoiceAgent(e){try{const{data:a,error:s}=await b.from(this.tableName).select("*").eq("id",e).single();return s?{data:null,error:s.message,success:!1}:{data:a,error:null,success:!0}}catch(a){return{data:null,error:"Failed to fetch voice agent",success:!1}}}async createVoiceAgent(e){try{const{data:a,error:s}=await b.from(this.tableName).insert(e).select().single();return s?{data:null,error:s.message,success:!1}:{data:a,error:null,success:!0}}catch(a){return{data:null,error:"Failed to create voice agent",success:!1}}}async updateVoiceAgent(e,a){try{const{data:s,error:t}=await b.from(this.tableName).update({...a,updated_at:(new Date).toISOString()}).eq("id",e).select().single();return t?{data:null,error:t.message,success:!1}:{data:s,error:null,success:!0}}catch(s){return{data:null,error:"Failed to update voice agent",success:!1}}}async deleteVoiceAgent(e){try{const{error:a}=await b.from(this.tableName).delete().eq("id",e);return a?{data:null,error:a.message,success:!1}:{data:!0,error:null,success:!0}}catch(a){return{data:null,error:"Failed to delete voice agent",success:!1}}}async getVoiceAgentStats(){try{const{data:e,error:a}=await b.from(this.tableName).select("status");if(a)return{data:null,error:a.message,success:!1};return{data:{total:e.length,active:e.filter(e=>"active"===e.status).length,inactive:e.filter(e=>"inactive"===e.status).length,training:e.filter(e=>"training"===e.status).length,error:e.filter(e=>"error"===e.status).length,totalCalls:0,successfulCalls:0,averageCallDuration:0,conversionRate:0},error:null,success:!0}}catch(e){return{data:null,error:"Failed to fetch voice agent stats",success:!1}}}async searchVoiceAgents(e){try{const{data:a,error:s}=await b.from(this.tableName).select("*").or(`name.ilike.%${e}%,description.ilike.%${e}%`).order("created_at",{ascending:!1}).limit(20);return s?{data:null,error:s.message,success:!1}:{data:a||[],error:null,success:!0}}catch(a){return{data:null,error:"Failed to search voice agents",success:!1}}}async createVapiAgent(e){try{return{data:{id:`vapi_${Date.now()}`,name:e.name,model:e.model||"gpt-4",voice:e.voice||"alloy",firstMessage:e.first_message||"Hello! How can I help you today?",systemMessage:e.system_message||"You are a helpful AI assistant.",maxDuration:e.max_duration||300,webhookUrl:e.webhook_url,status:"active"},error:null,success:!0}}catch(a){return{data:null,error:"Failed to create Vapi agent",success:!1}}}async updateVapiAgent(e,a){try{return{data:{id:e,...a,updated_at:(new Date).toISOString()},error:null,success:!0}}catch(s){return{data:null,error:"Failed to update Vapi agent",success:!1}}}async deleteVapiAgent(e){try{return{data:!0,error:null,success:!0}}catch(a){return{data:null,error:"Failed to delete Vapi agent",success:!1}}}async makeCall(e,a,s){try{return{data:{id:`call_${Date.now()}`,agent_id:e,client_id:s,phone_number:a,status:"initiated",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},error:null,success:!0}}catch(t){return{data:null,error:"Failed to make call",success:!1}}}async getAgentCalls(e){try{return{data:[{id:"call_1",agent_id:e,client_id:"client_1",phone_number:"+1234567890",status:"completed",duration:120,transcript:"Hello, this is a sample call transcript...",outcome:"successful",created_at:new Date(Date.now()-36e5).toISOString(),updated_at:new Date(Date.now()-36e5).toISOString()}],error:null,success:!0}}catch(a){return{data:null,error:"Failed to fetch agent calls",success:!1}}}subscribeToVoiceAgents(e){return b.channel("voice_agents_changes").on("postgres_changes",{event:"*",schema:"public",table:"voice_agents"},e).subscribe()}subscribeToVoiceAgentStats(e){return b.channel("voice_agent_stats_changes").on("postgres_changes",{event:"*",schema:"public",table:"voice_agents"},e).subscribe()}},X={all:["voiceAgents"],lists:()=>[...X.all,"list"],list:e=>[...X.lists(),{filters:e}],details:()=>[...X.all,"detail"],detail:e=>[...X.details(),e],stats:()=>[...X.all,"stats"],calls:e=>[...X.all,"calls",e],search:e=>[...X.all,"search",e]};const Z={active:{label:"Active",color:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300",icon:E},inactive:{label:"Inactive",color:"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300",icon:T},training:{label:"Training",color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300",icon:M},error:{label:"Error",color:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300",icon:z}},ee={sales:{label:"Sales",icon:"💰",color:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300"},support:{label:"Support",icon:"🛠️",color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300"},appointment:{label:"Appointment",icon:"📅",color:"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300"},follow_up:{label:"Follow-up",icon:"🔄",color:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300"},custom:{label:"Custom",icon:"⚙️",color:"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300"}};function ae(){const{isAuthenticated:e}=f(),[a,c]=n.useState(""),[d,g]=n.useState("all"),[p,b]=n.useState("all"),[E,M]=n.useState(!1),[z,H]=n.useState(null),[Q,Y]=n.useState(null),[K,P]=n.useState(!1),[O,$]=n.useState(""),{data:B,isLoading:R,error:G}=t({queryKey:X.list(ae),queryFn:()=>J.getVoiceAgents(ae),select:e=>e.data||[],staleTime:3e5});var ae;const se=function(){const e=r();return l({mutationFn:e=>J.createVoiceAgent(e),onSuccess:a=>{a.data?(e.invalidateQueries({queryKey:X.lists()}),e.invalidateQueries({queryKey:X.stats()}),v.success("Voice agent created successfully!")):v.error(a.error||"Failed to create voice agent")},onError:e=>{v.error("Failed to create voice agent")}})}(),te=function(){const e=r();return l({mutationFn:({id:e,...a})=>J.updateVoiceAgent(e,a),onSuccess:(a,s)=>{a.data?(e.setQueryData(X.detail(s.id),a.data),e.invalidateQueries({queryKey:X.lists()}),e.invalidateQueries({queryKey:X.stats()}),v.success("Voice agent updated successfully!")):v.error(a.error||"Failed to update voice agent")},onError:e=>{v.error("Failed to update voice agent")}})}(),re=function(){const e=r();return l({mutationFn:e=>J.deleteVoiceAgent(e),onSuccess:(a,s)=>{a.data?(e.removeQueries({queryKey:X.detail(s)}),e.invalidateQueries({queryKey:X.lists()}),e.invalidateQueries({queryKey:X.stats()}),v.success("Voice agent deleted successfully!")):v.error(a.error||"Failed to delete voice agent")},onError:e=>{v.error("Failed to delete voice agent")}})}(),le=function(){const e=r();return l({mutationFn:({id:e,status:a})=>J.updateVoiceAgent(e,{status:a}),onSuccess:(a,s)=>{a.data?(e.setQueryData(X.detail(s.id),a.data),e.invalidateQueries({queryKey:X.lists()}),e.invalidateQueries({queryKey:X.stats()}),v.success("Voice agent status updated!")):v.error(a.error||"Failed to update voice agent status")},onError:e=>{v.error("Failed to update voice agent status")}})}(),ne=function(){const e=r();return l({mutationFn:({agentId:e,phoneNumber:a,clientId:s})=>J.makeCall(e,a,s),onSuccess:(a,s)=>{a.data?(e.invalidateQueries({queryKey:X.calls(s.agentId)}),v.success("Call initiated successfully!")):v.error(a.error||"Failed to initiate call")},onError:e=>{v.error("Failed to initiate call")}})}(),ie=n.useMemo(()=>B?B.filter(e=>{var s;const t=e.name.toLowerCase().includes(a.toLowerCase())||(null==(s=e.description)?void 0:s.toLowerCase().includes(a.toLowerCase())),r="all"===d||e.status===d,l="all"===p||e.type===p;return t&&r&&l}):[],[B,a,d,p]);return e?R?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsx(h,{size:"lg",text:"Loading voice agents..."})}):G?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-red-600 dark:text-red-400 mb-2",children:"Error Loading Voice Agents"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:G.message||"Failed to load voice agents. Please try again."})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold gradient-text",children:"Voice Agents"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1",children:"Manage your AI voice agents powered by Vapi"})]}),s.jsxs(o,{onClick:()=>M(!0),className:"mt-4 sm:mt-0 bg-gradient-to-r from-primary to-primary-600 hover:from-primary-600 hover:to-primary-700 button-glow hover-lift",children:[s.jsx(y,{className:"w-4 h-4 mr-2"}),"Create Agent"]})]}),s.jsx(j,{children:s.jsx(N,{className:"p-6",children:s.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"relative",children:[s.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),s.jsx(u,{placeholder:"Search agents by name or description...",value:a,onChange:e=>c(e.target.value),className:"pl-10"})]})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("select",{value:d,onChange:e=>g(e.target.value),className:"px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[s.jsx("option",{value:"all",children:"All Status"}),s.jsx("option",{value:"active",children:"Active"}),s.jsx("option",{value:"inactive",children:"Inactive"}),s.jsx("option",{value:"training",children:"Training"}),s.jsx("option",{value:"error",children:"Error"})]}),s.jsxs("select",{value:p,onChange:e=>b(e.target.value),className:"px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-primary-500",children:[s.jsx("option",{value:"all",children:"All Types"}),s.jsx("option",{value:"sales",children:"Sales"}),s.jsx("option",{value:"support",children:"Support"}),s.jsx("option",{value:"appointment",children:"Appointment"}),s.jsx("option",{value:"follow_up",children:"Follow-up"}),s.jsx("option",{value:"custom",children:"Custom"})]})]})]})})}),0===ie.length?s.jsx(j,{children:s.jsxs(N,{className:"p-12 text-center",children:[s.jsx(w,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100 mb-2",children:a||"all"!==d||"all"!==p?"No agents found":"No voice agents created"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:a||"all"!==d||"all"!==p?"Try adjusting your search or filter criteria.":"Get started by creating your first AI voice agent."}),!a&&"all"===d&&"all"===p&&s.jsxs(o,{onClick:()=>M(!0),className:"bg-gradient-to-r from-primary to-primary-600 hover:from-primary-600 hover:to-primary-700",children:[s.jsx(y,{className:"w-4 h-4 mr-2"}),"Create Your First Agent"]})]})}):s.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:ie.map(e=>{var a;const t=Z[e.status],r=ee[e.type],l=t.icon;return s.jsxs(j,{className:"card-hover group",children:[s.jsx(_,{className:"pb-3",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx(A,{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 group-hover:text-primary transition-colors",children:e.name}),s.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[s.jsxs(S,{className:`${t.color} text-xs font-medium flex items-center gap-1`,children:[s.jsx(l,{className:"w-3 h-3"}),t.label]}),s.jsxs(S,{className:`${r.color} text-xs font-medium`,children:[r.icon," ",r.label]})]})]}),s.jsx("div",{className:"relative",children:s.jsx(o,{variant:"ghost",size:"sm",className:"opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsx(C,{className:"w-4 h-4"})})})]})}),s.jsxs(N,{className:"space-y-3",children:[e.description&&s.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:s.jsx("p",{className:"line-clamp-2",children:e.description})}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center text-sm text-slate-600 dark:text-slate-400",children:[s.jsx(m,{className:"w-4 h-4 mr-2 flex-shrink-0"}),s.jsxs("span",{className:"truncate",children:[e.model," • ",e.voice]})]}),s.jsxs("div",{className:"flex items-center text-sm text-slate-600 dark:text-slate-400",children:[s.jsx(I,{className:"w-4 h-4 mr-2 flex-shrink-0"}),s.jsx("span",{children:(null==(a=e.language)?void 0:a.toUpperCase())||"EN"})]}),s.jsxs("div",{className:"flex items-center text-sm text-slate-600 dark:text-slate-400",children:[s.jsx(x,{className:"w-4 h-4 mr-2 flex-shrink-0"}),s.jsxs("span",{children:["Max ",e.max_duration||300,"s"]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2 border-t border-slate-200 dark:border-slate-700",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:e.total_calls||0}),s.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Total Calls"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:e.conversion_rate?`${e.conversion_rate}%`:"0%"}),s.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"Conversion"})]})]}),s.jsx("div",{className:"space-y-2 pt-2 border-t border-slate-200 dark:border-slate-700",children:s.jsxs("div",{className:"flex gap-2",children:[s.jsx(u,{placeholder:"Test phone number",value:O,onChange:e=>$(e.target.value),className:"flex-1 text-sm"}),s.jsx(o,{size:"sm",onClick:()=>(async e=>{if(O.trim())try{await ne.mutateAsync({agentId:e.id,phoneNumber:O})}catch(a){}else alert("Please enter a phone number for the test call")})(e),disabled:ne.isPending||"active"!==e.status,className:"bg-green-600 hover:bg-green-700",children:s.jsx(F,{className:"w-3 h-3"})})]})}),s.jsxs("div",{className:"flex gap-2 pt-2 border-t border-slate-200 dark:border-slate-700",children:[s.jsxs(o,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>H(e),children:[s.jsx(V,{className:"w-3 h-3 mr-1"}),"Edit"]}),s.jsx(o,{variant:"outline",size:"sm",className:"flex-1",asChild:!0,children:s.jsxs(i,{to:`/voice-agents/${e.id}`,children:[s.jsx(q,{className:"w-3 h-3 mr-1"}),"View"]})}),s.jsx(o,{variant:"outline",size:"sm",onClick:()=>(async e=>{const a="active"===e.status?"inactive":"active";try{await le.mutateAsync({id:e.id,status:a})}catch(s){}})(e),disabled:le.isPending,className:"active"===e.status?"text-orange-600 hover:text-orange-700":"text-green-600 hover:text-green-700",children:"active"===e.status?s.jsx(T,{className:"w-3 h-3"}):s.jsx(D,{className:"w-3 h-3"})}),s.jsx(o,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:text-red-400 dark:hover:text-red-300 dark:hover:bg-red-900/20",onClick:()=>(e=>{Y(e),P(!0)})(e),children:s.jsx(L,{className:"w-3 h-3"})})]})]})]},e.id)})}),E&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:s.jsx(W,{voiceAgent:null,onSave:async e=>{try{await se.mutateAsync(e),M(!1)}catch(a){}},onCancel:()=>M(!1),isLoading:se.isPending})})}),z&&s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:s.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:s.jsx(W,{voiceAgent:z,onSave:async e=>{if(z)try{await te.mutateAsync({id:z.id,...e}),H(null)}catch(a){}},onCancel:()=>H(null),isLoading:te.isPending})})}),s.jsx(U,{isOpen:K,onClose:()=>P(!1),onConfirm:async()=>{if(Q)try{await re.mutateAsync(Q.id),Y(null),P(!1)}catch(e){}},title:"Delete Voice Agent",message:`Are you sure you want to delete "${null==Q?void 0:Q.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",variant:"destructive"})]}):s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:"Authentication Required"}),s.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:"Please sign in to view voice agents."}),s.jsx(o,{asChild:!0,children:s.jsx(i,{to:"/auth/login",children:"Sign In"})})]})})}export{ae as VoiceAgentsPage};
